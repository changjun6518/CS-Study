
# 개념 정리 

<br>

## 💡 커널이란 
---
<br/>

### ✔ 커널의 의미 
- 운영체제는 크기가 크기때문에 전체를 메모리에 올리른 것은 비효율적이다.
- 반드시 동작해야는 핵심부분만 메모리에 올리자 = 커널 
- 커널 = 운영체제의 핵심부분 = 운영체제의 목적 = 응용프로그램과 하드웨어 사이의 인터페이스 역할

<br/>

### ✔ 커널의 역할 
1. CPU 스케줄링 및 프로세스 관리
2. 메모리관리
3. I/O device 관리
4. IPC 
    - 컴퓨터 내부의 프로세스끼리 통신을 도와주는 역할 
5. 네트워크 
    - 다른 컴퓨터와의 통신을 위한 프로토콜 지원
6. File System


<br/>

### ✔ 정리 및 참고자료
- 운영체제과목에서 배우는 대표적인 것들이 커널의 역할 
- 참고자료 : https://velog.io/@bahar-j/%EC%BB%A4%EB%84%90Kernel%EC%9D%98-%EA%B8%B0%EB%8A%A5 (인터럽트 기능 구분 사진)



### 💡 인터럽트 

<br/>

### ✔ 인터럽트란 
- 인터럽트 = 방해하다, 중단시키다 = CPU의 프로그램 실행을 방해하였다.
- 인터럽트는 CPU 주변으로 부터 발생하는 신호
- 주변 = 하드웨어 or 프로그램 or 사용자의 호출   
- CPU는 해당 신호를 받으면 하던 일을 중단시키고, 인터럽트 신호를 처리한다. = 인터럽트 핸들러를 통해 인터럽트 서비스 루틴을 실행한다.

<br/>

### ✔ 인터럽트의 종류

1. 외부 인터럽트 
    - CPU 코어 외부에서 발생하는 인터럽트 (=전기적 신호)
    - 정전, 전원에 따른 인터럽트 
    - 기계고장 인터럽트 (CPU포함 기타 하드웨어)
    - 외부 인터럽트 (Timer- 스케줄링, Operator)
    - 입출력 인터럽트 ( 입출력 종료나 오류 , ctrl+Z)

2. 내부 인터럽트 
    - CPU 내부에서 실행하면서 발생하는 인터럽트 
    - 프로그램 문제로 인한
    - Divide by Zero , Overflow/underflow 등

3. 소프트웨어 인터럽트 

    - 시스템콜 = 사용자의 목저에 의해서 OS 를 호출하는 동작을 수행하는 경우 
    - 시스템 콜 내부에는 Trap이 있다.

- 내부 외부 기준은  CPU

<br/>

### ✔ 구성요소와 관련 개념 정리

1. 인터럽트 백터 테이블 
    - 인터럽트 발생시 처리해야할 루틴의 주소를 보관하고 있는 테이블
    
    - 예시 ) 인텔 x86에서는 이를 IDT(Interrupt Descriptor Table)이라고 하며, CPU는 IDTR(Interrupt Descriptor Table Register)라는 특수한 레지스터에 IDT 위치를 저장해놓음
    
2. 인터럽트 서비스 루틴 
    - 인터럽트 서비스 루틴 = 인터럽트 핸들러 
    - 실제 인터럽트를 처리하는 루틴
    - 실행 중이던 레지스터와 PC를 저장하여 실행중이던 CPU의 상태를 저장하고 인터럽트 처리가 끝나면 원래 상태로 복귀한다.
    - 인터럽트 서비스 루틴은 운영체제의 일부 

3. PIC 
    - Programmable Interrupt Controller (하드웨어임)
    - 다양한 주변으로부터 발생하는 인터럽트를 관리하는 장치 
    - 다양한 장치에서 인터럽트를 요청시 우선순위별로 선정하여 CPU에게 전달한다.
    - 각 장치들은 각각 IRQ line을 통해 PIC에게 인터럽트 요청을 하며 우선순위를 매겨서 cpu에게 전달한다. 
    - PIC 내부에서는 8비트의 IRR, IMR, ISR 레지스터를 사용합니다

4. IRR (Interrupt Request Regitster) 
    - 인터럽트를 요청한 장치에 대한 정보를 기록한다.
    - 총 8비트로 이루어져 있으며 외부 장치가 인터럽트를 발생시키면 PIC 컨트롤러는 IRR 레지스터에 해당 비트는 1로 설정하여 인터럽트 발생 여부는 저장합니다

5. ISR(Interrupt Service Register)
    - 현재 인터럽트 핸들러가 실행중인 인터럽트의 정보를 나타낸다

5. IMR(Interrupt Mask Register)
    - 비트가 1로 설정된 인터럽트 핀에서 발생한 요청을 무시하는 역할을 합니다. 

<br/>

### ✔ 인터럽트의 발생과정 

- 인터럽트 요청 -> 프로세스 중단 -> 현재 실행중인 프로세스 상태 보관 -> 인터럽트 서비스 루틴처리 -> 상태 복구 

- 상세과정 

    1. 인터럽트 발생

    2. 여러 장치가 인터럽트를 요청하는 경우 PIC는우선순위가 가장 높은 장치를 선정해 CPU에게 전달

    3. CPU는 PC를 통해 다음 명령어를 수행하기 전에 Interrup Request Bit가 set되어 있는지 확인

        - set되어 있으면 interrupt를 처리해야 하고 그렇지 않으면 PC가 가리키는 다음 주소공간의 명령어를 실행
    
    4. CPU는 실행중인 프로세스 컨테스트를 저장

        - context = CPU의 상태는 코드의 수행또는 상태와 관련된 레지스터에 기록된 데이터 집합 

    5.  CPUsms PIC가 data bus로 전달한 값을 사용하여 IVT에서 ISR주소를 확인함 
    
    6.  그리고 ISR값을 PC에 저장하여 CPU가 인터럽트를 처리한다. 

    6. 인터럽트 작업이 모두 끝나면 이전에 스택에 저장해놓았던 context를 복구하고 PC의 값을 바꿔 줌으로써 인터럽트 이전에 수행하던 프로세스의 작업을 마자 실행한다.

<br/>

### ✔ 정리 및 참고자료

https://kosaf04pyh.tistory.com/197 - 매우 구체적인 자료 + 효과적인 이해 

https://hibee.tistory.com/264 종류의 구분및 처리과정이 매우 상세함. 그림 정보는 없음 


<br/>

### 💡 커널모드 유저모드 

<br/>


### ✔ 커널모드 유저모드란 

- 운영체제는 매우 복잡한 일을 수행함 = 사용자가 함부로 건드리면 망가짐 = 하드웨어 자원할당 동작 오류 

- 이를 위해서 커널모드, 사용자모드  두가지 방식으로 나눔 

- 사실 PC가 가리키는 공간의 주소에 따라 커널모드/사용자모드로 나뉨

- 사실 커널만 접근가능한 메모리 영역, 응용프로그램이 사용하는 메모리 영역이라고 보면됨 

- 중요하고, 시스템의 오류를 발생시킬 부분은 커널부분이 동작, 덜 중요한 부분은 사용자모드라고 이해하면된다.


<br/>

### ✔ 정리 및 참고자료

- https://kosaf04pyh.tistory.com/196



### 💡 시스템콜 

<br/>

### ✔ 시스템 콜이란  
 
- 사용자 =응용프로그램 측면에서 커널모드의 동작을 사용하고 싶다 
- 그러나 사용자 모드에서는 커널 모드를 실행할 수없다.
- 이를 위해 사용자 모드에서 커널모드를 호출하여 해당 문제를 해결하도록 하였다.
- 사용자모드에서 커널모드의 사용을 위해 호출하는 인터페이스 
- 시스템 콜발생시 사용자 모드의 응요프로그램에서 커널모드의 시스템 콜 프로그램 실행으로 바뀐다.
- 시스템 콜도 인터럽트의 한종류 (기존 응용프로그램 - 중지 - 시스템 콜 프로그램) 


<br/>

### ✔ 시스템 콜 사용예시 

- 프로세스에서  자식프로세스를 생성할때  시스템 콜을 사용한다. 
- 시스템 콜은 어려운것이 아니고 그냥 함수라고 생각하면 된다. 
- 아래는 지식 프로세스르 생성하면서 발생하는 시스템 콜들을 정리한 것이다.

    1. folk() : 새 프로세스를 생성

    2. wait() : 자식 프로세스가 끝날 때까지 대기한다.

    3. exec() : 다른 프로그램을 실행한다


<br/>

### ✔ 정리 및 참고자료

- https://ju-hy.tistory.com/8



### 💡 커널수준 스레드 유저 수준 스레드  


<br/>

### ✔  스레드란 

- 프로세스 내에서 실행되는 흐름의 단위

- 일반적으로 한 프로그램은 하나의 스레드를 가지고 있지만, 프로그램 환경에 따라 둘 이상의 스레드를 동시에 실행할 수 있다.

- 자바의 메인 메서드가 하나의 메인 스레드이다. 여기서 스레드를 생성할 수 있다.


<br/>

### ✔  커널 수준 스레드


- 운영체제가 지원하는 스레드 기능으로 구현되며, 커널이 스레드의 생성 및 스케줄링 등을 관리함 

- 커널이 각 스레드를 개별적으로 관리하기 때문에 프로세스 내 스레드들이 병행으로 수행이 가능하다.

- 예를 들어 하나의 스레드가 고장나도 나머지는 동작이 가능하다.


<br/>

### ✔  사용자 수준 스레드

- 사용자 수준 스레드는 스레드 라이브러리에서 관리한다.

- 커널 수준 스레드는 contextSwitching 할때마다 오버헤드가 발생한다.

- 그러나 사용자 수준 스레든는 하나의 운영체제 작업단위 내에서 동작하기 떄문에 contextSwitching 문제가 발생하지 않는다. 

- 즉 커널과 무관한 스레드 

-  커널은 스레드의 존재를 인식하지 못하기 때문에 커널의 개입을 받지 않는다.

- 다수의 사용자 수준 스레드가 커널 수준 스레드 한개에 매핑됨

<br/>

### ✔혼합형 스레드란 

- 수준 스레드와 커널 수준 스레드를 혼합한 구조



<br/>

### ✔  스레드 풀링 

-  미리 생성한 스레드를 재사용하도록 하여 스레드를 생성하는 시간을 줄여준다

- 응용프로그램은 스레드풀을 사용하여 작없할 수 있다

- 성성 가능한 스레드의 수를 제한하면서 자원소비를 효울적으로 할 수 있게 한다.



<br/>

### ✔ 정리 및 참고자료

- https://yoongrammer.tistory.com/55


 
